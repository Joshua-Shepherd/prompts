task: "correct the results of OCR"
doc: "Given OCR results, correct them"
prompt-version: 2
todo:
- Redesign to make this work line-by-line
prompt: |+
    These are the results of performing
    optical character recognition on the
    historical documents.
    <delim>
    Input 1:
    <delim>
    1: r'2Pto flare i~t in the face; for this
    2: riea/on they ef~d all tho~-e Books which
    3: gave the least ac- of the Heathen Theology
    4: to the flames ;
    <delim>
    Correction 1:
    <delim>
    In 1: r'2Pto flare i~t in the face; for this
    Out 1: For a to flare it in the face; for this
    In 2: riea/on they ef~d all tho~-e Books which
    Out 2: reason they sacrificed all those books which
    In 3: gave the least ac- of the Heathen Theology
    Out 3: gave the least account of the Heathen Theology
    In 4: to the flames ;
    Out 4: to the flames;
    <delim>
    Input 2:
    <delim>
    <OCR text>
    <delim>
    Correction 2: 
    <delim>
    <:pp>In 1:
# engine: "OpenAI Codex"
# temperature: 0.3
force-engine: "OpenAI Davinci"
force-temperature: 0.8
# force-engine: "OpenAI Codex"
# force-temperature: 0.3
# max-generated-tokens: "(* 2 (pen-approximate-token-length ocr-text final-approximate-token-char-length))"
max-generated-tokens: "(* 1 (pen-approximate-token-length ocr-text final-approximate-token-char-length))"
# max-generated-tokens: 300
top-p: 1.0
stop-sequences:
- "<delim>"
cache: on
vars:
- "OCR text"
examples:
- |+
  they continu~e chofep ha~its ~fill in t-he mink .&fen th~at th~e generality of
  Mlankiind conts ing~r them~relv~es with a ju~per~fcial knowvledye th-ingfSif.
# TODO Add to .prompt optional multiplex preprocessor for inputs
# If a postprocessor sees pf- then check the function to see if it has
# multiplex capability
preprocessors:
- sed -z 's/\n\n/\n/g' | sed 's/\s\+/ /g'
# preprocessors:
# - pen-c strip-unicode | pen-str join ' '
# - pen-str onelineify
# postprocessor: "sed '/^In: /d' | sed 's/Out: //' | penf -u pf-correct-english-spelling-and-grammar/1"
postprocessor: "sed '/^In [0-9]*: /d' | sed 's/Out [0-9]*: //'"
filter: on
completion: off
insertion: off